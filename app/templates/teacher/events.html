{% extends "base.html" %}
{% from "elements/general_elements.html" import render_empty_state_block %}
{% from "elements/management_macros.html" import management_controls, management_card %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='style/pages/admin/management.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='style/pages/admin/events.css') }}">
{% endblock %}

{% block content %}
{{ render_header(page_title, page_description) }}
<main class="content-main">
<section class="section" aria-label="Мероприятия преподавателя">
    {{ management_controls('Название, дата или статус') }}

    {% if events %}
    <section class="management-grid management-grid--full events-grid" aria-label="Список мероприятий">
        {% for event in events %}
        {% set detail_payload = {
            'title': event.title_text,
            'status': event.status_label,
            'statusModifier': event.status_modifier,
            'statusHint': event.status_hint,
            'period': event.period_text,
            'consultations': event.consultations_count,
            'durationMinutes': event.duration_minutes,
            'consultationDurationMinutes': event.consultation_duration_minutes,
            'teacherNames': [],
            'meta': event.meta_items,
            'stats': [],
            'bookings': event.bookings
        } %}
        {% call management_card('event', 'Мероприятие', event.title_text, None) %}
            <div class="event-card__body" data-event-card data-event-detail='{{ detail_payload | tojson | safe }}' role="button" tabindex="0" aria-label="Подробнее о {{ event.title_text }}">
                <div class="event-card__top">
                    <div class="event-card__status">
                        <span class="management-badge management-badge--{{ event.status_modifier }} event-card__status-badge">{{ event.status_label }}</span>
                        {% if event.status_hint %}
                        <span class="event-card__status-hint">{{ event.status_hint }}</span>
                        {% endif %}
                    </div>
                    <div class="event-card__period">
                        <span class="event-card__period-label">Период</span>
                        <span class="event-card__period-value">{{ event.period_text }}</span>
                    </div>
                </div>

                {% if event.meta_items %}
                <div class="event-card__meta-grid">
                    {% for item in event.meta_items %}
                    <div class="event-card__meta-item">
                        <span class="event-card__meta-label">{{ item.label }}</span>
                        <span class="event-card__meta-value">{{ item.value }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="event-card__details-cue" aria-hidden="true">
                    <span class="event-card__details-label">Подробнее</span>
                    <span class="event-card__details-icon" aria-hidden="true">→</span>
                </div>
            </div>
        {% endcall %}
        {% endfor %}
    </section>
    {% else %}
    {{ render_empty_state_block('Пока нет мероприятий с вашим участием') }}
    {% endif %}

    <div class="event-details-modal" data-event-details-modal aria-hidden="true">
        <div class="event-details-modal__overlay" data-event-details-close></div>
        <div class="event-details-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="event-details-title">
            <header class="event-details-modal__header">
                <div class="event-details-modal__header-texts">
                    <h2 id="event-details-title" class="event-details-modal__title" data-event-details-title>Мероприятие</h2>
                    <div class="event-details-modal__status" data-event-details-status-container>
                        <span class="management-badge event-details-modal__status-badge" data-event-details-status></span>
                        <span class="event-details-modal__status-hint" data-event-details-status-hint></span>
                    </div>
                </div>
                <button type="button" class="event-details-modal__close" data-event-details-close aria-label="Закрыть подробности">
                    <span aria-hidden="true">×</span>
                </button>
            </header>
            <section class="event-details-modal__section">
                <h3 class="event-details-modal__section-label">Период</h3>
                <p class="event-details-modal__period" data-event-details-period></p>
            </section>
            <section class="event-details-modal__section event-details-modal__section--highlights">
                <div class="event-details-modal__highlight">
                    <span class="event-details-modal__highlight-value" data-event-details-consultations>0</span>
                    <span class="event-details-modal__highlight-label">консультаций</span>
                </div>
                <div class="event-details-modal__highlight">
                    <span class="event-details-modal__highlight-value" data-event-details-duration>0</span>
                    <span class="event-details-modal__highlight-label">длительность, мин</span>
                </div>
                <div class="event-details-modal__highlight" data-event-details-highlight-consultation-duration>
                    <span class="event-details-modal__highlight-value" data-event-details-consultation-duration>0</span>
                    <span class="event-details-modal__highlight-label">консультация, мин</span>
                </div>
            </section>
            <section class="event-details-modal__section">
                <h3 class="event-details-modal__section-label">Ключевые отметки</h3>
                <div class="event-details-modal__meta" data-event-details-meta></div>
            </section>
            <section class="event-details-modal__section" data-event-details-bookings-section>
                <h3 class="event-details-modal__section-label">Где проходит</h3>
                <ul class="event-details-modal__bookings-list" data-event-details-bookings></ul>
            </section>
        </div>
    </div>
</section>
</main>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="module" src="{{ url_for('static', filename='js/pages/teacher/events.js') }}"></script>
{% endblock %}
