{% extends "base.html" %}
{% from "elements/general_elements.html" import render_search, render_empty_state_block %}

{% set page_description = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—å—Å–∫–∏–º —Å–æ—Å—Ç–∞–≤–æ–º" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='style/pages/admin/teachers.css') }}">
{% endblock %}

{% block content %}
{{ render_header(page_title, page_description) }}
<main class="content-main">
<section class="section" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—è–º–∏">
    <div class="section-header">
        <div class="section-controls">
            {{ render_search('–ü–æ–∏—Å–∫ —É—á–∏—Ç–µ–ª—è') }}
            <div class="section-controls__buttons">
                <form class="teachers-import" data-teachers-import method="POST" enctype="multipart/form-data" action="{{ url_for('main.teachers_import') }}">
                    <input type="file" name="file" accept=".xlsx" hidden data-teachers-import-input>
                    <button type="button" class="button button--outline" data-teachers-import-trigger>
                        <span class="button__icon" aria-hidden="true">üìÑ</span>
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å —É—á–∏—Ç–µ–ª–µ–π
                    </button>
                </form>
                <button type="button" class="button main-button" data-teachers-add>
                    <span class="button__icon" aria-hidden="true">Ôºã</span>
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    {% if teachers %}
    <section class="teachers-grid" aria-label="–°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π">
        {% for teacher in teachers %}
        <article class="teacher-card">
            <div class="teacher-card__header">
                <span class="teacher-card__label">–§–ò–û</span>
                {% if can_manage_teachers %}
                <div class="teacher-card__menu" data-dropdown>
                    <button type="button" class="teacher-card__menu-toggle" data-dropdown-toggle aria-haspopup="true" aria-expanded="false">
                        <span class="visually-hidden">–î–µ–π—Å—Ç–≤–∏—è —Å —É—á–∏—Ç–µ–ª–µ–º</span>
                    </button>
                    <div class="teacher-card__menu-list" role="menu">
                        <button type="button"
                                class="teacher-card__menu-item"
                                role="menuitem"
                                data-action="edit"
                                data-teacher-id="{{ teacher.user_id }}"
                                data-teacher-full-name="{{ teacher.full_name }}"
                                data-teacher-email="{{ teacher.email }}">
                            –ü—Ä–∞–≤–∏—Ç—å
                        </button>
                        <button type="button"
                                class="teacher-card__menu-item teacher-card__menu-item--danger"
                                role="menuitem"
                                data-action="delete"
                                data-teacher-id="{{ teacher.user_id }}"
                                data-teacher-name="{{ teacher.full_name }}">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
            <h2 class="teacher-card__name">{{ teacher.full_name }}</h2>
            <div class="teacher-card__info">
                <span class="teacher-card__label">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</span>
                <a href="mailto:{{ teacher.email }}" class="teacher-card__email">{{ teacher.email }}</a>
            </div>
        </article>
        {% endfor %}
    </section>
    {% else %}
    {{ render_empty_state_block('–£—á–∏—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –¥–ª—è –≤–∞—à–µ–π —à–∫–æ–ª—ã') }}
    {% endif %}

    {% if can_manage_teachers %}
    {% set teacher_form = teacher_form_data or {} %}
    <div class="teachers-modal"
        data-teachers-modal
        {% if show_teacher_form %}data-open="true"{% endif %}
        data-mode="{{ teacher_form_mode or 'create' }}"
        {% if teacher_form_teacher_id %}data-teacher-id="{{ teacher_form_teacher_id }}"{% endif %}>
        <div class="teachers-modal__overlay" data-teachers-close></div>
        <div class="teachers-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="teacher-modal-title">
            <header class="teachers-modal__header">
                <h2 id="teacher-modal-title">
                    {% if teacher_form_mode == 'update' %}
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª—è
                    {% else %}
                    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—è
                    {% endif %}
                </h2>
                <button type="button" class="teachers-modal__close" data-teachers-close aria-label="–ó–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É">
                    <span aria-hidden="true">√ó</span>
                </button>
            </header>
            <form method="POST" class="teachers-modal__form" novalidate>
                <input type="hidden" name="form_type" value="{{ teacher_form_mode or 'create' }}">
                <input type="hidden" name="teacher_id" value="{{ teacher_form_teacher_id or '' }}">
                <div class="input-fields-container__row">
                    <label class="input-fields-container__row-label" for="teacher_full_name">–§–ò–û</label>
                    <input id="teacher_full_name" name="full_name" type="text" class="input-fields-container__row-input" placeholder="–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ" value="{{ teacher_form.get('full_name', '') }}" required>
                </div>
                <div class="input-fields-container__row">
                    <label class="input-fields-container__row-label" for="teacher_email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                    <input id="teacher_email" name="email" type="email" class="input-fields-container__row-input" placeholder="teacher@example.com" value="{{ teacher_form.get('email', '') }}" required>
                </div>
                <div class="input-fields-container__row" data-password-field{% if teacher_form_mode == 'update' %} hidden{% endif %}>
                    <label class="input-fields-container__row-label" for="teacher_password">–í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <input id="teacher_password" name="password" type="password" class="input-fields-container__row-input" placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤" minlength="8" required>
                </div>
                <footer class="teachers-modal__footer">
                    <button type="button" class="button button--outline" data-teachers-close>–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="button main-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </footer>
            </form>
        </div>
    </div>
    <form method="POST" class="teachers-delete-form" data-teachers-delete-form>
        <input type="hidden" name="form_type" value="delete">
        <input type="hidden" name="teacher_id" value="">
    </form>
    {% endif %}
</section>
</main>
{% endblock %}


{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='teachers.js') }}" defer></script>
{% endblock %}
