{% extends "base.html" %}
{% from "elements/general_elements.html" import render_empty_state_block %}
{% from "elements/management_macros.html" import management_controls, management_card, management_modal, management_delete_form, management_add_button %}

{% set page_description = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—å—Å–∫–∏–º —Å–æ—Å—Ç–∞–≤–æ–º" %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='style/pages/admin/management.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='style/pages/admin/teachers.css') }}">
{% endblock %}

{% block content %}
{{ render_header(page_title, page_description) }}
<main class="content-main">
<section class="section" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—è–º–∏">
    {% call management_controls('–ü–æ–∏—Å–∫ —É—á–∏—Ç–µ–ª—è') %}
        {% if can_manage_teachers %}
        <form class="teachers-import" data-teachers-import method="POST" enctype="multipart/form-data" action="{{ url_for('main.teachers_import') }}">
            <input type="file" name="file" accept=".xlsx" hidden data-teachers-import-input>
            <button type="button" class="button button--outline" data-teachers-import-trigger>
                <span class="button__icon" aria-hidden="true">üìÑ</span>
                –ó–∞–≥—Ä—É–∑–∏—Ç—å —É—á–∏—Ç–µ–ª–µ–π
            </button>
        </form>
        {{ management_add_button('data-teachers-add', '–î–æ–±–∞–≤–∏—Ç—å') }}
        {% endif %}
    {% endcall %}

    {% if teachers %}
    <section class="management-grid teachers-grid" aria-label="–°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π">
        {% for teacher in teachers %}
        {% set teacher_menu_config = None %}
        {% if can_manage_teachers %}
            {% set teacher_menu_config = {
                'aria_label': '–î–µ–π—Å—Ç–≤–∏—è —Å —É—á–∏—Ç–µ–ª–µ–º',
                'items': [
                    {
                        'action': 'edit',
                        'label': '–ü—Ä–∞–≤–∏—Ç—å',
                        'attrs': {
                            'data-teacher-id': teacher.user_id,
                            'data-teacher-full-name': teacher.full_name,
                            'data-teacher-email': teacher.email
                        }
                    },
                    {
                        'action': 'delete',
                        'label': '–£–¥–∞–ª–∏—Ç—å',
                        'danger': True,
                        'attrs': {
                            'data-teacher-id': teacher.user_id,
                            'data-teacher-name': teacher.full_name
                        }
                    }
                ]
            } %}
        {% endif %}
        {% call management_card('teacher', '–§–ò–û', teacher.full_name, '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞', teacher_menu_config) %}
            <a href="mailto:{{ teacher.email }}" class="teacher-card__email">{{ teacher.email }}</a>
        {% endcall %}
        {% endfor %}
    </section>
    {% else %}
    {{ render_empty_state_block('–£—á–∏—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –¥–ª—è –≤–∞—à–µ–π —à–∫–æ–ª—ã') }}
    {% endif %}

    {% if can_manage_teachers %}
    {% set teacher_form = teacher_form_data or {} %}
    {% set teacher_modal_config = {
        'prefix': 'teachers',
        'show': show_teacher_form,
        'mode': teacher_form_mode or 'create',
        'dataset_id_attr': 'teacher-id',
        'dataset_id_value': teacher_form_teacher_id,
        'title_create': '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—è',
        'title_update': '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª—è',
        'submit_create': '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        'submit_update': '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        'close_label': '–ó–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É',
        'hidden_fields': [
            {'name': 'form_type', 'value': teacher_form_mode or 'create'},
            {'name': 'teacher_id', 'value': teacher_form_teacher_id or ''}
        ]
    } %}
    {% call management_modal(teacher_modal_config) %}
        <div class="input-fields-container__row">
            <label class="input-fields-container__row-label" for="teacher_full_name">–§–ò–û</label>
            <input id="teacher_full_name" name="full_name" type="text" class="input-fields-container__row-input" placeholder="–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ" value="{{ teacher_form.get('full_name', '') }}" required>
        </div>
        <div class="input-fields-container__row">
            <label class="input-fields-container__row-label" for="teacher_email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
            <input id="teacher_email" name="email" type="email" class="input-fields-container__row-input" placeholder="teacher@example.com" value="{{ teacher_form.get('email', '') }}" required>
        </div>
        <div class="input-fields-container__row" data-password-field{% if teacher_form_mode == 'update' %} hidden{% endif %}>
            <label class="input-fields-container__row-label" for="teacher_password">–í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å</label>
            <input id="teacher_password" name="password" type="password" class="input-fields-container__row-input" placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤" minlength="8" required>
        </div>
    {% endcall %}
    {{ management_delete_form('teachers', 'teacher_id') }}
    {% endif %}
</section>
</main>
{% endblock %}


{% block scripts %}
{{ super() }}
<script type="module" src="{{ url_for('static', filename='js/pages/teachers/index.js') }}"></script>
{% endblock %}
